<project name="antlr" default="antlr-build" basedir=".">
  <!-- needs src and src-java from the file -->
  <import file="basic.xml" />
  <description>Antlr related stuff build File</description>
  <property name="antlr-src" value="CLO"/>
  <path id="antlr.path">
    <filelist dir="${lib}" files="antlr-3.1.3.jar"/>
  </path>
  <property name="antlr-src" value="${java-src}/ie/ucd/clops/dsl/parser"/>
	 
  <target name="antlr-build-check-uptodate">
    <echo message="Checking if the ANTLR generated files are up to date"/>
    <uptodate srcfile="${src}/${antlr-src}.g" targetfile="${antlr-src}/${antlr-src}Parser.java" property="antlrBuild.notRequired"/>
  </target>

  <target name="antlr-build" depends="antlr-build-check-uptodate" unless="antlrBuild.notRequired">
    <antcall target="antlr-clean"/>
    <echo message="Running antlr"/>
    <java fork="yes" dir="${java-src}" classname="org.antlr.Tool">
      <classpath refid="antlr.path" />
      <arg value="-o"/>
      <arg value="${antlr-src}"/>
      <arg value="${src}/${antlr-src}.g"/>
    </java>
  </target>
	
  <target name="antlr-clean" description="Clean up antlr generated files">
    <echo message="Deleting antlr generated files"/>
    <delete file="${antlr-src}/${antlr-src}.tokens"/>
    <delete file="${antlr-src}/${antlr-src}__.g"/>
    <delete file="${antlr-src}/${antlr-src}Parser.java"/>
    <delete file="${antlr-src}/${antlr-src}Lexer.java"/>
  </target>	
	
  <target name="antlr-test-build">
    <echo message="Running antlr"/>
    <java fork="yes" dir="${java-src}" classname="org.antlr.Tool">
      <classpath refid="antlr.path" />
      <arg value="-o"/>
      <arg value="${src}/java/ie/ucd/clops/test"/>
      <arg value="${src}/Test.g"/>
    </java>
  </target>
</project>