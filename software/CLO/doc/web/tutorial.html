<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <style type="text/css">@import url('clops.css');</style>
  <style type="text/css">@import url('prettify.css');</style>
  <script type="text/javascript" src="prettify.js"></script>
  <title>CLOPS tutorial</title>
</head>
<body onload="prettyPrint()">

<div class="title">CLOPS tutorial</div>

<p>I assume you have already read and followed the <a
href="install.html">installation instructions</a> for your
operating system. 
(TODO: Add overview, after the rest is written.)
</p>

<p>Please note that the examples below are <i>not</i> meant to
illustrate good style but rather to show many features in not
much space.</p>

<h1>Basic usage</h1>

<h2>A first example</h2>

<p>The <tt>wc</tt> tool computes statistics of a text, such as
the word count. Take a (short) look at its man page:</p>

<pre>man wc</pre>

<p>Create a fresh directory. All the commands in this tutorial
are written under the assumption that the current directory is
this fresh directory. Create a subdirectory <tt>src</tt> and in
it create a file <tt>wc.clops</tt> with the content: </p>

<pre class="prettyprint">
<!--#include virtual="examples/wc/src/wc.clops"-->
</pre>

<p>Create a subdirectory <tt>generated</tt> under <tt>src</tt>.
Generate the parser with:</p>

<pre>clops -i src/wc.clops -o src/generated -p generated</pre>

<p>You should see three files in <tt>src/generated</tt>,
each containing a class. (The option <tt>-p</tt> is followed
by a package name.) We'll place <tt>Main.java</tt> under
<tt>src</tt>.</p>

<pre class="prettyprint">
<!--#include virtual="examples/wc/src/Main.java"-->
</pre>

<p>(TODO: Mention that you can generate a <tt>Main</tt> for testing
somewhere in the advanced section.)</p>

<p>Create a subdirectory <tt>classes</tt>. To compile, say:</p>

<pre>
javac -cp CLOPSPATH/clops-runtime.jar -sourcepath src -d classes src/Main.java src/generated/*
</pre>

<p>On UNIX, replace <tt>CLOPSPATH</tt> by <tt>$CLOPSPATH</tt>. On
Windows, replace <tt>CLOPSPATH</tt> by <tt>%CLOPSPATH%</tt> and
<tt>/</tt>&nbsp;(slash) by <tt>\</tt>&nbsp;(backslash).</p>

<table class="gotcha">
<tr><td><img src="attention.png" alt="!"/></td><td>
Errors during compilation might be caused by
an incorrect CLOPS file. The code generation phase currently only
stops on the most obviously wrong CLOPS input.
</td></tr></table>

<p>You can now run your program with:</p>

<pre>java -cp classes:CLOPSPATH/clops-runtime.jar Main OPTIONS</pre>

<p>Try to replace <tt>OPTIONS</tt> with various values and see
what happens. In particular, try <tt>&quot;--files0-from=.&quot;</tt>,
<tt>&quot;--files0-from&nbsp;.&quot;</tt>, and only
<tt>&quot;--files0-from&quot;</tt>.</p>

<p>Congratulations: You have now finished the first part of the
tutorial and you saw how to use CLOPS instead of a hand-written
parser.</p>

<h2>Integrating with ANT</h2>

<p>The commands in the previous section are a little long but
hopefully you use a good build system that can handle the dirty
details for you. In this section you'll see how ANT can help.
Start by creating a directory <tt>jars</tt>. Populate it with all
the jar files in CLOPSPATH. Now create <tt>build.xml</tt>:</p>

<pre class="prettyprint">
<!--#exec cmd="sed 's/</\&amp;lt;/g' examples/wc/build.xml | sed 's/>/\&amp;gt;/g'"-->
</pre>

<p>There are two differences from a usual ANT file:</p>

<ol>
<li>Before invoking the compiler using the <tt>javac</tt> task
  we invoke CLOPS to generate some files.</li>
<li>The <tt>clops-runtime.jar</tt> is added to the classpath
  of the generated jar.</li>
</ol>

<p>You are now ready to use CLOPS. If you run into problems check
the <a href="faq.html">FAQ</a> and, if that doesn't help, send us
an email. (TODO: mailing list address.)</p>

<h1>Advanced features</h1>

<h2>The format: dealing with <tt>--</tt></h2>

<p>The <tt>wc</tt> command line implementation above is
<i>almost</i> OK. One problem is that it doesn't allow the user
to examine a file whose name is &quot;<tt>-w</tt>&quot; (or any
other name that conflicts with an option). The usual convention
to handle such situations is to use a special option (<tt>--</tt>)
and treat all that follows as being an operand (not an option).
</p>

<p>(TODO: The format string to deal with this POSIX convention.)</p>

<h2>Regular expressions as aliases</h2>

<p>(TODO: Examples like -0... -9.)</p>

<h2>Custom options</h2>

<h2>A complex example</h2>

<p>(TODO: Partial <tt>clops</tt> file for <tt>tar</tt> to illustrate
the main points.)</p>


<hr/>
<p>
  <a href="http://validator.w3.org/check?uri=referer"><img
     src="http://www.w3.org/Icons/valid-xhtml10-blue"
     alt="Valid XHTML 1.0 Strict" height="31" width="88" /></a>
</p>
</body>
</html>
<!--
vim: spell
-->
